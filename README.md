# ğŸš€ ä¼ä¸šçº§åˆ†å¸ƒå¼å¾®æœåŠ¡æ¡†æ¶

[![Go Version](https://img.shields.io/badge/Go-1.23+-00ADD8?style=flat&logo=go)](https://golang.org/)
[![Docker](https://img.shields.io/badge/Docker-Ready-2496ED?style=flat&logo=docker)](https://www.docker.com/)
[![License](https://img.shields.io/badge/License-MIT-green.svg)](https://opensource.org/licenses/MIT)

ä¸€ä¸ªåŸºäº Go çš„ç”Ÿäº§å°±ç»ªåˆ†å¸ƒå¼å¾®æœåŠ¡æ¡†æ¶ï¼Œé›†æˆäº†å®Œæ•´çš„è®¤è¯ã€ç›‘æ§ã€æœåŠ¡å‘ç°å’Œå®¹å™¨åŒ–éƒ¨ç½²èƒ½åŠ›ã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### ğŸ—ï¸ å¾®æœåŠ¡æ¶æ„
- **åˆ†å±‚æ¶æ„è®¾è®¡** - Handler â†’ Service â†’ Repository â†’ Model
- **ä¾èµ–æ³¨å…¥** - æ¥å£æŠ½è±¡å’Œä¾èµ–è§£è€¦
- **ä¸Šä¸‹æ–‡ä¼ é€’** - å®Œæ•´çš„è¯·æ±‚é“¾è·¯è¿½è¸ª
- **ä¼˜é›…å…³é—­** - æ”¯æŒå¹³æ»‘é‡å¯å’Œèµ„æºæ¸…ç†

### ğŸ” å®‰å…¨è®¤è¯
- **JWT è®¤è¯** - åŸºäº Token çš„æ— çŠ¶æ€è®¤è¯
- **å¯†ç åŠ å¯†** - Bcrypt å®‰å…¨å“ˆå¸Œç®—æ³•
- **æƒé™æ§åˆ¶** - åˆ†çº§ API è®¿é—®æƒé™
- **Token åˆ·æ–°** - è‡ªåŠ¨ç»­æœŸæœºåˆ¶

### ğŸ›¡ï¸ ç³»ç»Ÿä¿æŠ¤
- **API é™æµ** - å¤šå±‚æ¬¡é™æµä¿æŠ¤ï¼ˆIPã€ç”¨æˆ·ã€è‡ªå®šä¹‰ï¼‰
  - é…ç½®æ–‡ä»¶é©±åŠ¨çš„é™æµè§„åˆ™
  - æ”¯æŒå†…å­˜å’ŒRedisåŒå­˜å‚¨åç«¯
  - ç«¯ç‚¹çº§åˆ«çš„ç²¾ç»†åŒ–é™æµæ§åˆ¶
  - æ ‡å‡†HTTPå“åº”å¤´å’Œ429çŠ¶æ€ç 
- **ç†”æ–­å™¨** - é˜²æ­¢æœåŠ¡é›ªå´©å’Œçº§è”æ•…éšœ
- **é™çº§å¤„ç†** - æœåŠ¡ä¸å¯ç”¨æ—¶çš„ä¼˜é›…é™çº§
- **å®æ—¶ç›‘æ§** - é™æµå’Œç†”æ–­çŠ¶æ€ç›‘æ§

### ğŸ—„ï¸ æ•°æ®å­˜å‚¨
- **MySQL** - ä¸»æ•°æ®åº“ï¼Œæ”¯æŒäº‹åŠ¡å’Œè¿æ¥æ± 
- **Redis** - é«˜æ€§èƒ½ç¼“å­˜ï¼Œæ”¯æŒé›†ç¾¤
- **RabbitMQ** - å¯é æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ”¯æŒé‡è¿

### ğŸ”§ åŸºç¡€è®¾æ–½
- **Consul** - æœåŠ¡æ³¨å†Œä¸å‘ç°
- **Prometheus** - æŒ‡æ ‡æ”¶é›†å’Œç›‘æ§
- **Grafana** - å¯è§†åŒ–ç›‘æ§é¢æ¿
- **å¥åº·æ£€æŸ¥** - è‡ªåŠ¨æ•…éšœæ£€æµ‹

### ğŸ“š API æ–‡æ¡£
- **Swagger/OpenAPI** - è‡ªåŠ¨ç”Ÿæˆ API æ–‡æ¡£
- **äº¤äº’å¼æµ‹è¯•** - åœ¨çº¿ API è°ƒè¯•
- **è®¤è¯æ”¯æŒ** - Bearer Token é›†æˆ

### ğŸ³ å®¹å™¨åŒ–éƒ¨ç½²
- **Docker** - å¤šé˜¶æ®µæ„å»ºä¼˜åŒ–
- **Docker Compose** - ä¸€é”®éƒ¨ç½²å…¨æ ˆ
- **å¥åº·æ£€æŸ¥** - å®¹å™¨è‡ªåŠ¨æ¢å¤
- **æ•°æ®æŒä¹…åŒ–** - å·ç®¡ç†å’Œå¤‡ä»½

### ğŸ“Š ç›‘æ§æ—¥å¿—
- **ç»“æ„åŒ–æ—¥å¿—** - åŸºäº Zap çš„é«˜æ€§èƒ½æ—¥å¿—
- **HTTP æŒ‡æ ‡** - è¯·æ±‚æ•°é‡ã€å“åº”æ—¶é—´ã€çŠ¶æ€ç åˆ†å¸ƒ
- **æ•°æ®åº“æŒ‡æ ‡** - æŸ¥è¯¢æ—¶é—´ã€æ“ä½œç±»å‹ã€è¡¨çº§åˆ«ç»Ÿè®¡
- **ç¼“å­˜æŒ‡æ ‡** - å‘½ä¸­ç‡ã€å“åº”æ—¶é—´ã€å†…å­˜ä½¿ç”¨
- **åˆ†å¸ƒå¼è¿½è¸ª** - OpenTelemetry + Jaeger å®Œæ•´è¯·æ±‚é“¾è·¯è¿½è¸ª
- **å‘Šè­¦æ”¯æŒ** - é›†æˆ Prometheus AlertManager

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æœ¬åœ°å¼€å‘

```bash
# å…‹éš†é¡¹ç›®
git clone <repository-url>
cd distributed-service

# å®‰è£…ä¾èµ–
go mod tidy

# å¯åŠ¨æœ¬åœ°å¼€å‘
go run main.go
```

### Docker éƒ¨ç½²

```bash
# ä¸€é”®éƒ¨ç½²ï¼ˆæ¨èï¼‰
./deploy.sh

# æˆ–æ‰‹åŠ¨éƒ¨ç½²
docker-compose up --build -d
```

ğŸ“– **è¯¦ç»†éƒ¨ç½²æŒ‡å—**: [Docker éƒ¨ç½²æ–‡æ¡£](README-Docker.md)

## ğŸ“Š æœåŠ¡è®¿é—®åœ°å€

| æœåŠ¡ | åœ°å€ | ç”¨é€” | è®¤è¯ |
|------|------|------|------|
| ğŸ  ä¸»åº”ç”¨ | http://localhost:8080 | API æœåŠ¡ | JWT |
| ğŸ“– API æ–‡æ¡£ | http://localhost:8080/swagger/index.html | Swagger UI | - |
| ğŸ¥ å¥åº·æ£€æŸ¥ | http://localhost:8080/health | æœåŠ¡çŠ¶æ€ | - |
| ğŸ“Š æŒ‡æ ‡ç›‘æ§ | http://localhost:9090/metrics | Prometheus æŒ‡æ ‡ | - |
| ğŸ›¡ï¸ ç†”æ–­å™¨çŠ¶æ€ | http://localhost:8080/circuit-breaker/status | ç†”æ–­å™¨ç›‘æ§ | - |
| ğŸ“¡ Hystrix æµ | http://localhost:8080/hystrix | å®æ—¶ç›‘æ§æµ | - |
| ğŸ” é“¾è·¯è¿½è¸ª | http://localhost:16686 | Jaeger UI | - |
| ğŸ—‚ï¸ æœåŠ¡æ³¨å†Œ | http://localhost:8500 | Consul UI | - |
| ğŸ° æ¶ˆæ¯é˜Ÿåˆ— | http://localhost:15672 | RabbitMQ ç®¡ç† | guest/guest |
| ğŸ“ˆ ç›‘æ§ç³»ç»Ÿ | http://localhost:9091 | Prometheus | - |
| ğŸ“Š å¯è§†åŒ– | http://localhost:3000 | Grafana | admin/admin123 |

## ğŸ” API ä½¿ç”¨ç¤ºä¾‹

### å¿«é€Ÿæµ‹è¯•
```bash
# ç”¨æˆ·æ³¨å†Œ
curl -X POST http://localhost:8080/api/v1/auth/register \
  -H 'Content-Type: application/json' \
  -d '{"username":"newuser","email":"user@example.com","password":"password123"}'

# ç”¨æˆ·ç™»å½•
curl -X POST http://localhost:8080/api/v1/auth/login \
  -H 'Content-Type: application/json' \
  -d '{"username":"newuser","password":"password123"}'

# è®¿é—®å—ä¿æŠ¤ API
curl -X POST http://localhost:8080/api/v1/users \
  -H 'Authorization: Bearer YOUR_JWT_TOKEN' \
  -d '{"username":"protected","email":"protected@example.com","password":"password123"}'
```

ğŸ“– **å®Œæ•´APIæ–‡æ¡£**: [Swagger UI](http://localhost:8080/swagger/index.html) | [éƒ¨ç½²æ–‡æ¡£](README-Docker.md)

## ğŸ” åˆ†å¸ƒå¼è¿½è¸ª

### å¿«é€Ÿæµ‹è¯•
```bash
# è¿è¡Œè¿½è¸ªæµ‹è¯•
./scripts/test-tracing.sh

# ç”Ÿæˆè¿½è¸ªæ•°æ®
curl -X POST http://localhost:8080/api/v1/auth/register \
  -H 'X-Request-ID: trace-test' \
  -d '{"username":"traceuser","email":"trace@example.com","password":"password123"}'
```

### æŸ¥çœ‹è¿½è¸ªé“¾è·¯
- è®¿é—® [Jaeger UI](http://localhost:16686)
- é€‰æ‹©æœåŠ¡ `distributed-service`
- æŸ¥çœ‹å®Œæ•´çš„è¯·æ±‚è°ƒç”¨é“¾

### è¿½è¸ªè¦†ç›–
- **HTTPå±‚**: è¯·æ±‚è·¯å¾„ã€çŠ¶æ€ç ã€å“åº”æ—¶é—´
- **Serviceå±‚**: ä¸šåŠ¡é€»è¾‘æ‰§è¡Œæ—¶é—´
- **Repositoryå±‚**: æ•°æ®åº“æ“ä½œå’ŒSQLæ‰§è¡Œæ—¶é—´
- **é”™è¯¯è¿½è¸ª**: å¼‚å¸¸ä¿¡æ¯å’Œé”™è¯¯å †æ ˆ

ğŸ“– **è¯¦ç»†æ–‡æ¡£**: [åˆ†å¸ƒå¼è¿½è¸ªä½¿ç”¨æŒ‡å—](docs/TRACING.md)

## ğŸ“Š ç›‘æ§æŒ‡æ ‡

### æŒ‡æ ‡ç±»å‹
- **HTTPè¯·æ±‚**: è¯·æ±‚æ•°é‡ã€å“åº”æ—¶é—´ã€çŠ¶æ€ç åˆ†å¸ƒ
- **æ•°æ®åº“æŸ¥è¯¢**: æŸ¥è¯¢æ—¶é—´ã€æ“ä½œç±»å‹ã€è¡¨çº§åˆ«ç»Ÿè®¡  
- **ç¼“å­˜æ€§èƒ½**: å‘½ä¸­ç‡ã€å“åº”æ—¶é—´ã€å†…å­˜ä½¿ç”¨
- **åˆ†å¸ƒå¼è¿½è¸ª**: å®Œæ•´è¯·æ±‚é“¾è·¯è¿½è¸ª

### å¿«é€ŸéªŒè¯
```bash
# æµ‹è¯•æ•°æ®åº“æŒ‡æ ‡
./scripts/test-metrics.sh

# æŸ¥çœ‹æŒ‡æ ‡æ•°æ®
curl http://localhost:9090/metrics | grep database_query_duration
```

### ç›‘æ§é¢æ¿
- **Prometheus**: http://localhost:9091
- **Grafana**: http://localhost:3000 (admin/admin123)
- **æŒ‡æ ‡ç«¯ç‚¹**: http://localhost:9090/metrics

## ğŸ›¡ï¸ ç³»ç»Ÿä¿æŠ¤

### åŠŸèƒ½ç‰¹æ€§
- **å¤šå±‚é™æµ**: IPé™æµã€ç”¨æˆ·é™æµã€è‡ªå®šä¹‰é™æµ
- **æ™ºèƒ½ç†”æ–­**: é˜²æ­¢æœåŠ¡é›ªå´©å’Œçº§è”æ•…éšœ
- **ä¼˜é›…é™çº§**: æœåŠ¡ä¸å¯ç”¨æ—¶çš„å¤‡ç”¨å“åº”
- **å®æ—¶ç›‘æ§**: é™æµå’Œç†”æ–­çŠ¶æ€å¯è§†åŒ–

### é™æµé…ç½®
é¡¹ç›®æ”¯æŒé€šè¿‡é…ç½®æ–‡ä»¶ç®¡ç†æ‰€æœ‰é™æµè§„åˆ™ï¼Œæ”¯æŒå¤šç§å­˜å‚¨åç«¯ï¼š

```yaml
ratelimit:
  enabled: true                    # å¯ç”¨é™æµ
  store_type: redis               # memory æˆ– redis
  redis_prefix: "ratelimit:"      # Redisé”®å‰ç¼€
  default_config:                 # é»˜è®¤é…ç½®
    health_check: "10-S"          # å¥åº·æ£€æŸ¥ï¼š10æ¬¡/ç§’
    auth_public: "20-M"           # è®¤è¯ç«¯ç‚¹ï¼š20æ¬¡/åˆ†é’Ÿ
    auth_protected: "10-M"        # ä¿æŠ¤ç«¯ç‚¹ï¼š10æ¬¡/åˆ†é’Ÿ
    user_public: "30-M"           # ç”¨æˆ·å…¬å¼€APIï¼š30æ¬¡/åˆ†é’Ÿ
    user_protected: "50-M"        # ç”¨æˆ·ä¿æŠ¤APIï¼š50æ¬¡/åˆ†é’Ÿ
  endpoints:                      # ç«¯ç‚¹ç‰¹å®šé…ç½®
    "/health": "10-S"
    "/api/v1/auth/register": "20-M"
    "/api/v1/auth/login": "20-M"
    # ... æ›´å¤šç«¯ç‚¹é…ç½®
```

### å¿«é€Ÿæµ‹è¯•
```bash
# 1. è¿è¡ŒåŸºç¡€é™æµåŠŸèƒ½æµ‹è¯•
./scripts/test-ratelimit.sh
# æµ‹è¯•å†…å®¹: IPé™æµã€ç«¯ç‚¹é™æµã€å“åº”å¤´éªŒè¯ã€é…ç½®éªŒè¯

# 2. è¿è¡Œç³»ç»Ÿä¿æŠ¤ç»¼åˆæµ‹è¯• 
./scripts/test-ratelimit-circuitbreaker.sh
# æµ‹è¯•å†…å®¹: é™æµ+ç†”æ–­å™¨ã€Rediså­˜å‚¨ã€ç›‘æ§ç«¯ç‚¹ã€é”™è¯¯å¤„ç†

# 3. æ‰‹åŠ¨å¿«é€ŸéªŒè¯é™æµ
for i in {1..15}; do curl -w "HTTP_%{http_code}\n" http://localhost:8080/health; sleep 0.1; done
# é¢„æœŸ: å‰10ä¸ªè¿”å›200ï¼Œå5ä¸ªè¿”å›429

# 4. éªŒè¯é…ç½®æ–‡ä»¶æ­£ç¡®æ€§
./scripts/validate-config.sh
# æ£€æŸ¥: é…ç½®æ–‡ä»¶å®Œæ•´æ€§ã€é™æµæ ¼å¼ã€ç¼–è¯‘éªŒè¯

# 5. æŸ¥çœ‹ç†”æ–­å™¨å®æ—¶çŠ¶æ€
curl http://localhost:8080/circuit-breaker/status | jq '.'
# æ˜¾ç¤º: ç†”æ–­å™¨çŠ¶æ€ã€é”™è¯¯ç‡ã€è¯·æ±‚é‡ç­‰
```

### æµ‹è¯•è„šæœ¬ç‰¹æ€§
- âœ… **æœåŠ¡å¥åº·æ£€æŸ¥**: è‡ªåŠ¨æ£€æµ‹æœåŠ¡å¯ç”¨æ€§ï¼Œæ”¯æŒé‡è¯•æœºåˆ¶
- âœ… **å½©è‰²è¾“å‡º**: ç›´è§‚çš„æµ‹è¯•ç»“æœå±•ç¤ºï¼ŒæˆåŠŸ/å¤±è´¥/è­¦å‘ŠçŠ¶æ€åŒºåˆ†
- âœ… **è¯¦ç»†æŠ¥å‘Š**: æµ‹è¯•é€šè¿‡ç‡ç»Ÿè®¡ï¼Œé—®é¢˜è¯Šæ–­å»ºè®®
- âœ… **é”™è¯¯å¤„ç†**: ä¼˜é›…çš„é”™è¯¯å¤„ç†å’Œå›é€€æœºåˆ¶
- âœ… **é…ç½®éªŒè¯**: è‡ªåŠ¨éªŒè¯é…ç½®æ–‡ä»¶å®Œæ•´æ€§å’Œæ ¼å¼æ­£ç¡®æ€§

### é™æµç­–ç•¥
- **IPé™æµ**: åŸºäºå®¢æˆ·ç«¯IPåœ°å€ï¼Œé€‚ç”¨äºå…¬å¼€API
- **ç”¨æˆ·é™æµ**: åŸºäºJWT tokenä¸­çš„ç”¨æˆ·IDï¼Œé€‚ç”¨äºè®¤è¯API
- **è‡ªå®šä¹‰é™æµ**: æ”¯æŒè‡ªå®šä¹‰é”®ç”Ÿæˆå‡½æ•°çš„çµæ´»é™æµ
- **ç«¯ç‚¹é™æµ**: æ ¹æ®é…ç½®æ–‡ä»¶è‡ªåŠ¨åº”ç”¨ä¸åŒè§„åˆ™

### å­˜å‚¨åç«¯
- **å†…å­˜å­˜å‚¨**: é€‚ç”¨äºå¼€å‘ç¯å¢ƒå’Œå•å®ä¾‹éƒ¨ç½²
- **Rediså­˜å‚¨**: é€‚ç”¨äºç”Ÿäº§ç¯å¢ƒå’Œåˆ†å¸ƒå¼éƒ¨ç½²ï¼Œæ”¯æŒè‡ªåŠ¨é™çº§

### é…ç½®æ¦‚è§ˆ
- **å¥åº·æ£€æŸ¥**: 10æ¬¡/ç§’ IPé™æµ
- **è®¤è¯ç«¯ç‚¹**: 20æ¬¡/åˆ†é’Ÿ IPé™æµ  
- **ç”¨æˆ·API**: 30-50æ¬¡/åˆ†é’Ÿ ç”¨æˆ·é™æµ
- **ç†”æ–­ä¿æŠ¤**: 2-5ç§’è¶…æ—¶ï¼Œ25-50%é”™è¯¯ç‡é˜ˆå€¼

### å“åº”å¤´ä¿¡æ¯
é™æµè§¦å‘æ—¶ä¼šè¿”å›æ ‡å‡†çš„HTTPå“åº”å¤´ï¼š
- `X-RateLimit-Limit`: é™æµä¸Šé™
- `X-RateLimit-Remaining`: å‰©ä½™è¯·æ±‚æ•°
- `X-RateLimit-Reset`: é‡ç½®æ—¶é—´æˆ³
- `HTTP 429`: Too Many Requests çŠ¶æ€ç 

### ç›‘æ§ç«¯ç‚¹
- **ç†”æ–­å™¨çŠ¶æ€**: http://localhost:8080/circuit-breaker/status
- **Hystrixæµ**: http://localhost:8080/hystrix

ğŸ“– **è¯¦ç»†æ–‡æ¡£**: [é™æµåŠŸèƒ½è¯¦ç»†è¯´æ˜](docs/RATELIMIT.md) | [é™æµå’Œç†”æ–­å™¨ä½¿ç”¨æŒ‡å—](docs/RATELIMIT-CIRCUITBREAKER.md)

## ğŸ“ é¡¹ç›®ç»“æ„

```
distributed-service/
â”œâ”€â”€ ğŸ³ å®¹å™¨åŒ–éƒ¨ç½²
â”‚   â”œâ”€â”€ Dockerfile                 # å¤šé˜¶æ®µæ„å»ºé…ç½®
â”‚   â”œâ”€â”€ docker-compose.yaml       # æœåŠ¡ç¼–æ’é…ç½®
â”‚   â”œâ”€â”€ deploy.sh                 # ä¸€é”®éƒ¨ç½²è„šæœ¬
â”‚   â””â”€â”€ .dockerignore             # Docker å¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ âš™ï¸ é…ç½®ç®¡ç†
â”‚   â””â”€â”€ config/
â”‚       â”œâ”€â”€ config.yaml           # å¼€å‘ç¯å¢ƒé…ç½®
â”‚       â”œâ”€â”€ config-docker.yaml    # ç”Ÿäº§ç¯å¢ƒé…ç½®
â”‚       â”œâ”€â”€ redis.conf            # Redis é…ç½®
â”‚       â””â”€â”€ prometheus.yml        # ç›‘æ§é…ç½®
â”œâ”€â”€ ğŸ—„ï¸ è„šæœ¬å·¥å…·
â”‚   â””â”€â”€ scripts/
â”‚       â”œâ”€â”€ mysql-init.sql        # æ•°æ®åº“åˆå§‹åŒ–
â”‚       â”œâ”€â”€ test-tracing.sh       # åˆ†å¸ƒå¼è¿½è¸ªæµ‹è¯•è„šæœ¬
â”‚       â”œâ”€â”€ test-metrics.sh       # æ•°æ®åº“æŒ‡æ ‡æµ‹è¯•è„šæœ¬
â”‚       â”œâ”€â”€ test-ratelimit.sh     # é™æµåŠŸèƒ½æµ‹è¯•è„šæœ¬(æ”¹è¿›ç‰ˆ)
â”‚       â”œâ”€â”€ test-ratelimit-circuitbreaker.sh  # é™æµå’Œç†”æ–­å™¨ç»¼åˆæµ‹è¯•è„šæœ¬(æ”¹è¿›ç‰ˆ)
â”‚       â””â”€â”€ validate-config.sh    # é…ç½®éªŒè¯è„šæœ¬
â”œâ”€â”€ ğŸ“š API æ–‡æ¡£
â”‚   â””â”€â”€ docs/                     # Swagger ç”Ÿæˆæ–‡æ¡£
â”‚       â”œâ”€â”€ TRACING.md            # åˆ†å¸ƒå¼è¿½è¸ªä½¿ç”¨æŒ‡å—
â”‚       â”œâ”€â”€ RATELIMIT.md          # é™æµåŠŸèƒ½è¯¦ç»†æ–‡æ¡£
â”‚       â””â”€â”€ RATELIMIT-SUMMARY.md  # é™æµåŠŸèƒ½å®ç°æ€»ç»“
â”œâ”€â”€ ğŸ—ï¸ åº”ç”¨ä»£ç 
â”‚   â”œâ”€â”€ internal/                 # å†…éƒ¨ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ api/                  # HTTP å¤„ç†å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.go           # è®¤è¯æ¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ user.go           # ç”¨æˆ·æ¥å£
â”‚   â”‚   â”‚   â””â”€â”€ router.go         # è·¯ç”±é…ç½®
â”‚   â”‚   â”œâ”€â”€ service/              # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”‚   â”‚   â””â”€â”€ user.go           # ç”¨æˆ·æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ repository/           # æ•°æ®è®¿é—®å±‚
â”‚   â”‚   â”‚   â””â”€â”€ user.go           # ç”¨æˆ·ä»“åº“
â”‚   â”‚   â””â”€â”€ model/                # æ•°æ®æ¨¡å‹å±‚
â”‚   â”‚       â”œâ”€â”€ user.go           # ç”¨æˆ·æ¨¡å‹
â”‚   â”‚       â””â”€â”€ auth.go           # è®¤è¯æ¨¡å‹
â”‚   â””â”€â”€ pkg/                      # å…¬å…±ç»„ä»¶åŒ…
â”‚       â”œâ”€â”€ config/               # é…ç½®ç®¡ç†
â”‚       â”œâ”€â”€ database/             # æ•°æ®åº“è¿æ¥
â”‚       â”œâ”€â”€ logger/               # æ—¥å¿—ç®¡ç†
â”‚       â”œâ”€â”€ middleware/           # ä¸­é—´ä»¶
â”‚       â”œâ”€â”€ metrics/              # æŒ‡æ ‡æ”¶é›†
â”‚       â”œâ”€â”€ auth/                 # è®¤è¯ç»„ä»¶
â”‚       â”œâ”€â”€ mq/                   # æ¶ˆæ¯é˜Ÿåˆ—
â”‚       â”œâ”€â”€ registry/             # æœåŠ¡æ³¨å†Œ
â”‚       â”œâ”€â”€ ratelimit/            # APIé™æµ
â”‚       â”œâ”€â”€ circuitbreaker/       # ç†”æ–­å™¨
â”‚       â””â”€â”€ tracing/              # åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ª
â”œâ”€â”€ go.mod                        # Go æ¨¡å—ä¾èµ–
â”œâ”€â”€ go.sum                        # ä¾èµ–æ ¡éªŒæ–‡ä»¶
â”œâ”€â”€ main.go                       # åº”ç”¨å…¥å£
â”œâ”€â”€ README.md                     # é¡¹ç›®æ–‡æ¡£
â””â”€â”€ README-Docker.md              # éƒ¨ç½²æ–‡æ¡£
```

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°çš„ API ç«¯ç‚¹

1. **å®šä¹‰æ•°æ®æ¨¡å‹** (`internal/model/`)
```go
type YourModel struct {
    ID   uint   `json:"id" gorm:"primarykey"`
    Name string `json:"name"`
}
```

2. **å®ç°æ•°æ®è®¿é—®** (`internal/repository/`)
```go
type YourRepository interface {
    Create(ctx context.Context, model *YourModel) error
}
```

3. **ç¼–å†™ä¸šåŠ¡é€»è¾‘** (`internal/service/`)
```go
type YourService interface {
    Create(ctx context.Context, req *CreateRequest) error
}
```

4. **åˆ›å»º HTTP å¤„ç†å™¨** (`internal/api/`)
```go
// @Summary Create item
// @Router /api/v1/items [post]
func (h *YourHandler) Create(c *gin.Context) {
    // å®ç°é€»è¾‘
}
```

5. **æ³¨å†Œè·¯ç”±** (`internal/api/router.go`)
```go
items := v1.Group("/items")
items.POST("", handler.Create)
```

6. **ç”Ÿæˆæ–‡æ¡£**
```bash
swag init
```

### æ·»åŠ é™æµå’Œç†”æ–­å™¨ä¿æŠ¤

åœ¨æ–°çš„APIç«¯ç‚¹ä¸­æ·»åŠ é™æµå’Œç†”æ–­å™¨ä¿æŠ¤ï¼š

```go
// åœ¨è·¯ç”±æ³¨å†Œæ—¶æ·»åŠ é™æµä¸­é—´ä»¶
authBase := v1.Group("/auth")
authBase.Use(rateLimiter.IPRateLimit(rateLimiter.GetConfiguredLimit("auth_public"))) // ä½¿ç”¨é…ç½®çš„é™æµè§„åˆ™
{
    authBase.POST("/register", 
        circuitBreaker.Middleware("auth_register", nil),
        authHandler.Register)
}

// ä¸åŒç±»å‹çš„é™æµç­–ç•¥
// 1. ä½¿ç”¨é…ç½®çš„é™æµè§„åˆ™
r.GET("/health", rateLimiter.IPRateLimit(rateLimiter.GetConfiguredLimit("health_check")), handler)

// 2. ä½¿ç”¨è‡ªå®šä¹‰é™æµè§„åˆ™
r.POST("/api/v1/upload", rateLimiter.IPRateLimit("5-M"), handler) // æ¯åˆ†é’Ÿ5æ¬¡

// 3. ç”¨æˆ·çº§åˆ«é™æµï¼ˆéœ€è¦JWTè®¤è¯ï¼‰
protectedGroup := v1.Group("/protected")
protectedGroup.Use(middleware.JWTAuth(jwtManager))
protectedGroup.Use(rateLimiter.UserRateLimit(rateLimiter.GetConfiguredLimit("user_protected")))

// 4. ç«¯ç‚¹ç‰¹å®šé™æµï¼ˆä»é…ç½®æ–‡ä»¶è¯»å–ï¼‰
r.POST("/special", rateLimiter.EndpointRateLimit("/special"), handler)

// é…ç½®è‡ªå®šä¹‰ç†”æ–­å™¨
circuitbreaker.ConfigureCommand("my_service", circuitbreaker.Config{
    Timeout:                3000, // 3ç§’è¶…æ—¶
    MaxConcurrentRequests:  50,   // æœ€å¤§50å¹¶å‘
    RequestVolumeThreshold: 10,   // 10ä¸ªè¯·æ±‚åå¼€å§‹ç»Ÿè®¡
    SleepWindow:            5000, // 5ç§’ä¼‘çœ çª—å£
    ErrorPercentThreshold:  30,   // 30%é”™è¯¯ç‡é˜ˆå€¼
})
```

### é™æµé…ç½®ç®¡ç†

åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ æ–°çš„ç«¯ç‚¹é™æµè§„åˆ™ï¼š

```yaml
# config/config.yaml æˆ– config/config-docker.yaml
ratelimit:
  enabled: true
  store_type: redis  # ç”Ÿäº§ç¯å¢ƒä½¿ç”¨redisï¼Œå¼€å‘ç¯å¢ƒå¯ä»¥ä½¿ç”¨memory
  redis_prefix: "ratelimit:"
  default_config:
    health_check: "10-S"
    auth_public: "20-M"
    auth_protected: "10-M"
    user_public: "30-M"
    user_protected: "50-M"
    custom_api: "100-H"        # æ–°å¢ï¼šè‡ªå®šä¹‰APIæ¯å°æ—¶100æ¬¡
  endpoints:
    "/health": "10-S"
    "/api/v1/auth/register": "20-M"
    "/api/v1/auth/login": "20-M"
    "/api/v1/special": "5-M"   # æ–°å¢ï¼šç‰¹æ®Šç«¯ç‚¹æ¯åˆ†é’Ÿ5æ¬¡
    "/api/v1/upload": "10-H"   # æ–°å¢ï¼šä¸Šä¼ ç«¯ç‚¹æ¯å°æ—¶10æ¬¡
```

**é™æµæ ¼å¼è¯´æ˜**ï¼š
- `10-S`: æ¯ç§’10æ¬¡
- `20-M`: æ¯åˆ†é’Ÿ20æ¬¡  
- `100-H`: æ¯å°æ—¶100æ¬¡
- `1000-D`: æ¯å¤©1000æ¬¡

### æ·»åŠ æ•°æ®åº“æŒ‡æ ‡ç›‘æ§

åœ¨æ–°çš„ Repository å±‚æ·»åŠ æ•°æ®åº“æŒ‡æ ‡è®°å½•ï¼š

```go
import "distributed-service/pkg/metrics"

// Repository å±‚ç¤ºä¾‹
func (r *userRepository) Create(ctx context.Context, user *model.User) error {
    // ä½¿ç”¨ MeasureDatabaseQuery åŒ…è£…æ•°æ®åº“æ“ä½œ
    err := metrics.MeasureDatabaseQuery("CREATE", "users", func() error {
        return r.db.WithContext(ctx).Create(user).Error
    })
    return err
}

// å¸¦è¿”å›å€¼çš„æŸ¥è¯¢æ“ä½œ
func (r *userRepository) GetByID(ctx context.Context, id uint) (*model.User, error) {
    user, err := metrics.MeasureDatabaseQueryWithResult("SELECT", "users", func() (*model.User, error) {
        var user model.User
        err := r.db.WithContext(ctx).First(&user, id).Error
        return &user, err
    })
    return user, err
}
```

**æŒ‡æ ‡æ ‡ç­¾è§„èŒƒ**ï¼š
- `operation`: CREATE, SELECT, UPDATE, DELETE
- `table`: å®é™…çš„è¡¨åï¼ˆå¦‚ï¼šusers, orders ç­‰ï¼‰

### é…ç½®ç®¡ç†

ä¿®æ”¹é…ç½®æ–‡ä»¶åé‡å¯åº”ç”¨ï¼š
```bash
# å¼€å‘ç¯å¢ƒ
vim config/config.yaml
go run main.go

# Docker ç¯å¢ƒ
vim config/config-docker.yaml
docker-compose restart app
```

## ğŸ” æ•…éšœæ’æŸ¥

### æŸ¥çœ‹æœåŠ¡çŠ¶æ€
```bash
docker-compose ps
```

### æŸ¥çœ‹åº”ç”¨æ—¥å¿—
```bash
docker-compose logs -f app
```

### æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—
```bash
docker-compose logs mysql
docker-compose logs redis
docker-compose logs rabbitmq
```

### é‡å¯æœåŠ¡
```bash
docker-compose restart app
```

### å®Œå…¨é‡æ–°éƒ¨ç½²
```bash
docker-compose down -v --remove-orphans
docker-compose up --build -d
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### æ•°æ®åº“ä¼˜åŒ–
- è¿æ¥æ± é…ç½®ï¼š`max_idle_conns`, `max_open_conns`
- ç´¢å¼•ä¼˜åŒ–ï¼šä¸ºå¸¸ç”¨æŸ¥è¯¢å­—æ®µæ·»åŠ ç´¢å¼•
- æŸ¥è¯¢ä¼˜åŒ–ï¼šä½¿ç”¨ GORM çš„é¢„åŠ è½½å’Œé€‰æ‹©å­—æ®µ

### ç¼“å­˜ç­–ç•¥
- Redis ç¼“å­˜çƒ­ç‚¹æ•°æ®
- è®¾ç½®åˆç†çš„è¿‡æœŸæ—¶é—´
- ä½¿ç”¨ç¼“å­˜å‡»ç©¿ä¿æŠ¤

### ç›‘æ§å‘Šè­¦
- è®¾ç½® Prometheus å‘Šè­¦è§„åˆ™
- é…ç½® Grafana ç›‘æ§é¢æ¿
- ç›‘æ§å…³é”®æŒ‡æ ‡ï¼šå“åº”æ—¶é—´ã€é”™è¯¯ç‡ã€ååé‡ã€æ•°æ®åº“æ€§èƒ½

### æ•°æ®åº“æ€§èƒ½ç›‘æ§
- æŸ¥è¯¢å“åº”æ—¶é—´åˆ†å¸ƒ
- å„æ“ä½œç±»å‹ï¼ˆCRUDï¼‰çš„æ‰§è¡Œé¢‘ç‡
- è¡¨çº§åˆ«çš„æŸ¥è¯¢ç»Ÿè®¡
- æ…¢æŸ¥è¯¢è¯†åˆ«å’Œä¼˜åŒ–

## ğŸ”’ å®‰å…¨å»ºè®®

### ç”Ÿäº§ç¯å¢ƒé…ç½®
1. **ä¿®æ”¹é»˜è®¤å¯†ç **
   - JWT å¯†é’¥ï¼š`config.jwt.secret_key`
   - æ•°æ®åº“å¯†ç ï¼š`config.mysql.password`
   - Grafana å¯†ç ï¼š`GF_SECURITY_ADMIN_PASSWORD`

2. **ç½‘ç»œå®‰å…¨**
   - ä½¿ç”¨ HTTPS/TLS åŠ å¯†é€šä¿¡
   - é…ç½®é˜²ç«å¢™è§„åˆ™
   - é™åˆ¶ç«¯å£è®¿é—®

3. **è®¤è¯å®‰å…¨**
   - è®¾ç½®åˆç†çš„ Token è¿‡æœŸæ—¶é—´
   - å®ç° Token é»‘åå•æœºåˆ¶
   - æ·»åŠ  API é™æµä¿æŠ¤

4. **é™æµå®‰å…¨é…ç½®**
   - æ ¹æ®ä¸šåŠ¡éœ€æ±‚è°ƒæ•´é™æµé˜ˆå€¼
   - ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ Redis å­˜å‚¨ç¡®ä¿åˆ†å¸ƒå¼ä¸€è‡´æ€§
   - ç›‘æ§429çŠ¶æ€ç çš„é¢‘ç‡ï¼ŒåŠæ—¶è°ƒæ•´é™æµç­–ç•¥
   - ä¸ºé‡è¦APIè®¾ç½®æ›´ä¸¥æ ¼çš„é™æµè§„åˆ™

## ğŸ“š æ–‡æ¡£å¯¼èˆª

| æ–‡æ¡£ | å†…å®¹ | é€‚ç”¨åœºæ™¯ |
|------|------|----------|
| [README.md](README.md) | é¡¹ç›®æ¦‚è§ˆã€æ ¸å¿ƒåŠŸèƒ½ã€å¼€å‘æŒ‡å— | äº†è§£é¡¹ç›®ã€æœ¬åœ°å¼€å‘ |
| [README-Docker.md](README-Docker.md) | Dockeréƒ¨ç½²ã€è¿ç»´ã€æ•…éšœæ’æŸ¥ | å®¹å™¨åŒ–éƒ¨ç½²ã€ç”Ÿäº§è¿ç»´ |
| [TRACING.md](docs/TRACING.md) | åˆ†å¸ƒå¼è¿½è¸ªè¯¦ç»†è¯´æ˜ | æ·±å…¥äº†è§£è¿½è¸ªåŠŸèƒ½ |
| [RATELIMIT.md](docs/RATELIMIT.md) | é™æµåŠŸèƒ½å®Œæ•´æ–‡æ¡£ | é™æµé…ç½®å’Œä½¿ç”¨ |
| [RATELIMIT-SUMMARY.md](docs/RATELIMIT-SUMMARY.md) | é™æµåŠŸèƒ½å®ç°æ€»ç»“ | æŠ€æœ¯å®ç°è¯¦æƒ… |
| [RATELIMIT-CIRCUITBREAKER.md](docs/RATELIMIT-CIRCUITBREAKER.md) | é™æµç†”æ–­å™¨è¯¦ç»†é…ç½® | ç³»ç»Ÿä¿æŠ¤æœºåˆ¶é…ç½® |
| [Swagger UI](http://localhost:8080/swagger/index.html) | åœ¨çº¿APIæ–‡æ¡£ | APIæ¥å£è°ƒè¯• |

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/amazing-feature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add amazing feature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/amazing-feature`)
5. åˆ›å»º Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…

## ğŸ™ è‡´è°¢

æ„Ÿè°¢ä»¥ä¸‹å¼€æºé¡¹ç›®ï¼š
- [Gin](https://github.com/gin-gonic/gin) - HTTP Web æ¡†æ¶
- [GORM](https://github.com/go-gorm/gorm) - ORM åº“
- [Viper](https://github.com/spf13/viper) - é…ç½®ç®¡ç†
- [Zap](https://github.com/uber-go/zap) - é«˜æ€§èƒ½æ—¥å¿—åº“
- [JWT-Go](https://github.com/golang-jwt/jwt) - JWT å®ç°
- [Consul](https://github.com/hashicorp/consul) - æœåŠ¡å‘ç°
- [Prometheus](https://github.com/prometheus/prometheus) - ç›‘æ§ç³»ç»Ÿ 